// all the variables
var developermode = false;
var wrapper = $(".wrapper");
var wrapperbg = $(".wrapper-background");
var left_aside = localStorage.getItem("left_aside");
var startWinwidth = $(window).outerWidth(true);

if (left_aside === 'off' && startWinwidth <= 992) {
    wrapperbg.addClass('none');
}

if (left_aside === 'on' && startWinwidth <= 992) {
    wrapperbg.removeClass('none');
}

$(document).ready(function() {

    // aside toggle, hide and show programm start
    function asideToggle() {
        if(wrapper.hasClass('aside-close')) {
            asideShow();
            asideStatusAjax('on');
        } else {
            asideHide();
            asideStatusAjax('off');
        }
    }

    function asideStatusAjax(status)
    {
        $.ajax({
            type: 'GET',
            url: '/dashboard/ajax-left-sidebar-status',
            data: {status:status},
            dataType: 'json',
        });
    }

    function asideHide() {
        localStorage.setItem("left_aside", 'off');
        wrapper.addClass("aside-close");

        if(startWinwidth <= 992) {
            wrapperbg.removeClass('none');
        }
    }
    function asideShow() {
        localStorage.setItem("left_aside", 'on');
        wrapper.removeClass("aside-close");

        if(startWinwidth <= 992) {
            wrapperbg.addClass('none');
        }
    }

    function layer() {
        var display = false;
        // get the window width
        var winwidth = $(window).outerWidth(true);
        // console.log(winwidth);

        if(winwidth <= 992) {
            if(wrapperbg.hasClass('none')) {
                wrapperbg.removeClass('none');
                display = false;
            } else {
                wrapperbg.addClass('none');
                display = true;
            }
        }
        return display;
    }


    // click on toggle button (toggle)
    $("#full-screen-btn").on("click", function(event) {
        var doc = window.document;
        var docEl = doc.documentElement;

        var requestFullScreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullScreen || docEl.msRequestFullscreen;
        var cancelFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen || doc.msExitFullscreen;

        if(!doc.fullscreenElement && !doc.mozFullScreenElement && !doc.webkitFullscreenElement && !doc.msFullscreenElement) {
           requestFullScreen.call(docEl);
        }
        else {
           cancelFullScreen.call(doc);
        }
    });


    // click on toggle button (toggle)
    $("#aside-toggle").on("click", function(event) {
        asideToggle();
        layer();

        event.preventDefault();
    });


    // click on the wrapper-background (close)
    $(".wrapper-background").on("click", function() {
        asideHide();
        layer();
    });


    // click on the aside-close (close)
    $('#aside-close').on("click", function() {
        asideStatusAjax('off');
        asideHide();
        layer();
    });


    // on resize event aside toggle (toggle, optional)
    $(window).on("resize", function() {
        if(developermode) {
            asideToggle();
            layer();
        }
    });


    // dropdown toggle programm start
    $(".dropdown > a").on("click", function(event) {
        var parent = $(this).closest("li.dropdown");

        if(parent.hasClass("active")) {
            parent.removeClass("active");
        } else {
            parent.addClass("active");
            $( "li.dropdown" ).not( parent ).removeClass( "active" );
        }
        event.preventDefault();
    });

    // user dropdown toggle programm start
    $(".user-dropdown > a").on("click", function(event) {
        var parent = $(this).closest("li.user-dropdown");

        if(parent.hasClass("active")) {
            parent.removeClass("active");
        } else {
            parent.addClass("active");
            $( "li.user-dropdown" ).not( parent ).removeClass( "active" );
        }
        event.preventDefault();
    });

    $(document).click(function(event){
        var value = $(event.target).closest('.user-dropdown > a, .user-dropdown .sub-menu').length;
        if (value == 0) {
            if ($('.user-dropdown').hasClass('active')) {
                $('.user-dropdown').removeClass('active');
            }
        }
    });


    // rightbar script
    sidebarToggle('.settings','.right-bar', 'active');

	function sidebarToggle(clickElement, sidebarElement, sidebarClass, eventName='click') {
		$(clickElement).on(eventName, function(){
			var sidebar = $(sidebarElement);
			if (sidebar.hasClass(sidebarClass)) {
				sidebar.removeClass(sidebarClass);
			}else{
				sidebar.addClass(sidebarClass);
			}
		});

		$(document).on(eventName, function (event) {
			var value = $(event.target).closest(clickElement + ',' + sidebarElement).length;
			if (value == 0) {
				if ($(sidebarElement).hasClass(sidebarClass)) {
					$(sidebarElement).removeClass(sidebarClass);
				}
			}
		});
	}


    // nicescroll plugin
    // $(".aside-nav, .right-bar, .type-select").niceScroll({
    //     cursorcolor: 'rgba(152, 166, 173, 0.5)',
    //     cursorwidth: '6px',
    //     cursorborderradius: '0px'
    // });

    // $(".right-bar").niceScroll({
    //     cursorcolor: 'rgba(152, 166, 173, 0.5)',
    //     cursorwidth: '6px',
    //     cursorborderradius: '0px'
    // });


    // list dropdown
    var menu = $('.wrapper').data('menu'),
        submenu = $('.wrapper').data('submenu'),
        bread = $('.wrapper').data('bread');


    var li = '.aside-nav li#'+menu;

    $(li).addClass('active');
    $(li + ' ul li#' +menu+'-'+submenu).addClass('active');

    if (bread != 'none') {
        $(".breadcrumbs nav a[data-bread='"+bread+"']").addClass('active');
    } else {
        $(".breadcrumbs nav a").removeClass('active');        
    }


    // print media
    $('#print').click(function(){
        window.print();
    });
});

$('.right-bar .color-changer-container #nav_color_primary').on('input',function(){
    change_navigation_primary_colors($(this).val());
});

$('.right-bar .color-changer-container #nav_color_secondary').on('input',function(){
    change_navigation_secondary_colors($(this).val());
});

$('.right-bar .color-changer-container #brand_color').on('input',function(){
    change_brand_colors($(this).val());
});

function change_navigation_primary_colors(color = '#0078D7') {
    localStorage.setItem("primary_color", color);
    var style_1 = 'body .main-nav { background: '+color+'}';
    $('head .primary-settings').html(style_1);
}

function change_navigation_secondary_colors(color = '#0078D7') {
    localStorage.setItem("secondary_color", color);
    var style_1 = 'body .brand, body .right-bar .title { background: '+color+' !important}';
    $('head .secondary-settings').html(style_1);
}

function change_brand_colors(color = '#0078D7') {
    localStorage.setItem("brand_color", color);
    localStorage.setItem("brand_color_70", color+'82');
    localStorage.setItem("brand_color_30", color+'47');

    var extra = 'body .body-content .tabs-form .nav-tabs .nav-link.active {background: '+color+'} body .aside-nav li.active > a, body .body-header .header-title h3 {color: '+color+'} body .dataTables_wrapper .dt-buttons button {background-color: '+color+'} body .dataTables_wrapper .dt-buttons button:hover {background-color: '+color+'82} body .dataTables_wrapper .dt-buttons button {border-color: '+color+'} body .body-content .table-action a { color: '+color+'; background: '+color+'47; } .body-content .table-action a:hover { background: '+color+'82; } body .aside-nav li a:hover { color: '+color+' }';
    var checkbox_style_before = 'body .body-content .delete-check input[type=checkbox] + label:before { border-color: '+color+' }';
    var checkbox_style_after = '.body-content .delete-check input[type=checkbox]:checked + label:after { background: '+color+' }';

    var switch_style_1 = 'body .body-content .status input[type=checkbox]:checked + label { background: '+color+'82}';
    var switch_style_2 = 'body .body-content .status input[type=checkbox]:checked + label { border: 1px solid '+color+'47}';
    var switch_style_3 = 'body .body-content .status input[type=checkbox] + label:before { background: '+color+'47}';
    var switch_style_4 = 'body .body-content .status input[type=checkbox] + label { border: 1px solid '+color+'47 }';

    $('head .brand-settings').html(extra+checkbox_style_before+checkbox_style_after+switch_style_1+switch_style_2+switch_style_3+switch_style_4);
}

set_colors_input();

function set_colors_input() {
    $('.right-bar .color-changer-container #nav_color_primary').val(localStorage.getItem('primary_color')?? document.documentElement.style.getPropertyValue('--primary'));
    $('.right-bar .color-changer-container #nav_color_secondary').val(localStorage.getItem('secondary_color')?? document.documentElement.style.getPropertyValue('--secondary'));
    $('.right-bar .color-changer-container #brand_color').val(localStorage.getItem('brand_color')?? document.documentElement.style.getPropertyValue('--brand'));
}

function currentDatetime() {
    let currentDatetime = moment().tz(myTimezone).format('YYYY-MM-DDTHH:mm');
    return currentDatetime;
}

function currentDate() {
    let currentDatetime = moment().tz(myTimezone).format('YYYY-MM-DD');
    return currentDatetime;
}

$(document).on('click', 'input[type="datetime-local"]', function() { this.showPicker(); });